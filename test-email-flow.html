<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Flow Test - Mihri's Kraamzorg</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #c87461;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #c87461;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #a65f50; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .test-form {
            display: grid;
            gap: 15px;
            max-width: 400px;
        }
        .test-form input, .test-form textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-form label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Email Flow Test - Mihri's Kraamzorg</h1>
        <p>Deze pagina test alle email verzend methoden om te controleren of ze correct werken.</p>

        <div class="test-section">
            <h3>1. EmailJS Test</h3>
            <div id="emailjs-status" class="status info">Klik op "Test EmailJS" om te testen</div>
            <button onclick="testEmailJS()">Test EmailJS</button>
            <p><strong>Status:</strong> <span id="emailjs-details">Niet getest</span></p>
        </div>

        <div class="test-section">
            <h3>2. PHP Service Test</h3>
            <div id="php-status" class="status info">Klik op "Test PHP Service" om te testen</div>
            <button onclick="testPHPService()">Test PHP Service</button>
            <p><strong>Status:</strong> <span id="php-details">Niet getest</span></p>
        </div>

        <div class="test-section">
            <h3>3. Mailto Link Test</h3>
            <div id="mailto-status" class="status info">Klik op "Test Mailto" om te testen</div>
            <button onclick="testMailto()">Test Mailto Link</button>
            <p><strong>Status:</strong> <span id="mailto-details">Niet getest</span></p>
        </div>

        <div class="test-section">
            <h3>4. Complete Formulier Test</h3>
            <p>Test het complete formulier met alle fallback niveaus:</p>
            <form class="test-form" id="test-form">
                <label>Naam: <input type="text" name="naam" value="Test Gebruiker" required></label>
                <label>Email: <input type="email" name="email" value="test@example.com" required></label>
                <label>Telefoon: <input type="tel" name="telefoon" value="0612345678" required></label>
                <label>Uitgerekende datum: <input type="date" name="due_date" value="2024-06-01" required></label>
                <label>Zorgverzekeraar: <input type="text" name="zorgverzekeraar" value="Zilveren Kruis"></label>
                <label>Woonplaats: <input type="text" name="plaats" value="Amsterdam"></label>
                <label>BSN: <input type="text" name="bsn" value="123456789"></label>
                <label>Polisnummer: <input type="text" name="polisnummer" value="POL123456"></label>
                <label>Toelichting: <textarea name="bericht">Dit is een test bericht</textarea></label>
                <label><input type="checkbox" name="consent" required> Ik ga akkoord</label>
                <button type="submit">Test Complete Formulier</button>
            </form>
            <div id="form-status" class="status info">Vul het formulier in en klik op "Test Complete Formulier"</div>
        </div>

        <div class="test-section">
            <h3>5. Test Resultaten</h3>
            <div id="test-results">
                <p>Voer tests uit om resultaten te zien...</p>
            </div>
        </div>
    </div>

    <!-- EmailJS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
    <script>
        // Initialize EmailJS - Vervang met je eigen public key
        emailjs.init("user_1234567890abcdef");

        let testResults = {
            emailjs: null,
            php: null,
            mailto: null,
            form: null
        };

        async function testEmailJS() {
            const statusEl = document.getElementById('emailjs-status');
            const detailsEl = document.getElementById('emailjs-details');
            
            statusEl.className = 'status info';
            statusEl.textContent = 'Testing EmailJS...';
            detailsEl.textContent = 'Testing...';

            try {
                const emailData = {
                    to_email: 'mihriskraamzorg@hotmail.com',
                    from_name: 'Test Gebruiker',
                    from_email: 'test@example.com',
                    phone: '0612345678',
                    due_date: '2024-06-01',
                    zorgverzekeraar: 'Zilveren Kruis',
                    plaats: 'Amsterdam',
                    bsn: '123456789',
                    polisnummer: 'POL123456',
                    bericht: 'Dit is een test bericht'
                };

                await emailjs.send('service_1234567', 'template_1234567', emailData);
                
                statusEl.className = 'status success';
                statusEl.textContent = 'EmailJS Test: SUCCESS';
                detailsEl.textContent = 'EmailJS verzending succesvol';
                testResults.emailjs = 'success';
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'EmailJS Test: FAILED';
                detailsEl.textContent = `Error: ${error.message}`;
                testResults.emailjs = 'failed';
            }
            
            updateTestResults();
        }

        async function testPHPService() {
            const statusEl = document.getElementById('php-status');
            const detailsEl = document.getElementById('php-details');
            
            statusEl.className = 'status info';
            statusEl.textContent = 'Testing PHP Service...';
            detailsEl.textContent = 'Testing...';

            try {
                const formData = new FormData();
                formData.append('naam', 'Test Gebruiker');
                formData.append('email', 'test@example.com');
                formData.append('telefoon', '0612345678');
                formData.append('due_date', '2024-06-01');
                formData.append('zorgverzekeraar', 'Zilveren Kruis');
                formData.append('plaats', 'Amsterdam');
                formData.append('bsn', '123456789');
                formData.append('polisnummer', 'POL123456');
                formData.append('bericht', 'Dit is een test bericht');
                formData.append('consent', 'on');

                const response = await fetch('send-email.php', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    statusEl.className = 'status success';
                    statusEl.textContent = 'PHP Service Test: SUCCESS';
                    detailsEl.textContent = 'PHP service verzending succesvol';
                    testResults.php = 'success';
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'PHP Service Test: FAILED';
                detailsEl.textContent = `Error: ${error.message}`;
                testResults.php = 'failed';
            }
            
            updateTestResults();
        }

        function testMailto() {
            const statusEl = document.getElementById('mailto-status');
            const detailsEl = document.getElementById('mailto-details');
            
            try {
                const subject = encodeURIComponent('Test Aanmelding Kraamzorg');
                const body = encodeURIComponent(
                    `Beste Mihri,

Dit is een test email.

Mijn gegevens:
- Naam: Test Gebruiker
- Email: test@example.com
- Telefoon: 0612345678
- Uitgerekende datum: 2024-06-01

Met vriendelijke groet,
Test Gebruiker`
                );
                
                const mailtoLink = `mailto:mihriskraamzorg@hotmail.com?subject=${subject}&body=${body}`;
                window.open(mailtoLink);
                
                statusEl.className = 'status success';
                statusEl.textContent = 'Mailto Test: SUCCESS';
                detailsEl.textContent = 'Mailto link geopend in email client';
                testResults.mailto = 'success';
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Mailto Test: FAILED';
                detailsEl.textContent = `Error: ${error.message}`;
                testResults.mailto = 'failed';
            }
            
            updateTestResults();
        }

        // Test complete formulier (simuleert de echte formulier logica)
        document.getElementById('test-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const statusEl = document.getElementById('form-status');
            statusEl.className = 'status info';
            statusEl.textContent = 'Testing complete formulier flow...';

            try {
                // Simuleer de echte formulier logica
                const emailData = {
                    to_email: 'mihriskraamzorg@hotmail.com',
                    from_name: document.querySelector('[name="naam"]').value,
                    from_email: document.querySelector('[name="email"]').value,
                    phone: document.querySelector('[name="telefoon"]').value,
                    due_date: document.querySelector('[name="due_date"]').value,
                    zorgverzekeraar: document.querySelector('[name="zorgverzekeraar"]').value || 'Niet opgegeven',
                    plaats: document.querySelector('[name="plaats"]').value || 'Niet opgegeven',
                    bsn: document.querySelector('[name="bsn"]').value || 'Niet opgegeven',
                    polisnummer: document.querySelector('[name="polisnummer"]').value || 'Niet opgegeven',
                    bericht: document.querySelector('[name="bericht"]').value || 'Geen toelichting opgegeven'
                };

                // Try EmailJS first
                try {
                    await emailjs.send('service_1234567', 'template_1234567', emailData);
                    statusEl.className = 'status success';
                    statusEl.textContent = 'Complete Formulier Test: SUCCESS (EmailJS)';
                    testResults.form = 'success-emailjs';
                } catch (emailjsError) {
                    console.warn('EmailJS failed, trying PHP fallback:', emailjsError);
                    
                    // Fallback to PHP service
                    const formData = new FormData(e.target);
                    const response = await fetch('send-email.php', {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        statusEl.className = 'status success';
                        statusEl.textContent = 'Complete Formulier Test: SUCCESS (PHP Fallback)';
                        testResults.form = 'success-php';
                    } else {
                        throw new Error('Both email services failed');
                    }
                }
            } catch (error) {
                statusEl.className = 'status error';
                statusEl.textContent = 'Complete Formulier Test: FAILED';
                testResults.form = 'failed';
            }
            
            updateTestResults();
        });

        function updateTestResults() {
            const resultsEl = document.getElementById('test-results');
            let html = '<h4>Test Resultaten:</h4><ul>';
            
            Object.entries(testResults).forEach(([test, result]) => {
                if (result) {
                    const status = result.includes('success') ? '✅' : '❌';
                    const testName = test.charAt(0).toUpperCase() + test.slice(1);
                    html += `<li>${status} ${testName}: ${result}</li>`;
                }
            });
            
            html += '</ul>';
            
            // Overall status
            const allTests = Object.values(testResults).filter(r => r !== null);
            const successCount = allTests.filter(r => r.includes('success')).length;
            
            if (allTests.length > 0) {
                html += `<p><strong>Overall Status:</strong> ${successCount}/${allTests.length} tests successful</p>`;
            }
            
            resultsEl.innerHTML = html;
        }
    </script>
</body>
</html>
